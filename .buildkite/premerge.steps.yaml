---
common: &common
  agents:
    - "agent_count=8"
    - "boot_disk_size_gb=400"
    - "capable_of_building=platform"
    - "machine_type=quad"
    - "queue=${CI_LINUX_BUILDER_QUEUE:-v4-20-06-23-173521-bk12705-2627bc3f-d}"
    - "platform=linux"
    - "permission_set=builder"
    - "scaler_version=2"
    - "environment=${CI_ENVIRONMENT:-cn-production}"
  retry:
    automatic:
      # These are designed to trap and retry failures because agent lost connection.     Agent exits with -1 in this case.
      - exit_status: -1
        limit: 3
      - exit_status: 255
        limit: 3
      - exit_status: 240 # Within platform, we interpret this to be a Docker-related ex    it code
        limit: 3

steps:
  - label: "frontend premerge"
    <<: *common
    commands:
      - npm install --save-dev jest-cli
      - cd superset-frontend && npm t
    plugins:
      - docker#v3.5.0:
          image: "eu.gcr.io/windy-oxide-102215/superset-ci:20200721-1002-6672-feature-chinf-1637-985"
